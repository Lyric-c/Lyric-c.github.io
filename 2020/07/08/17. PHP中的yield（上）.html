<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>17. PHP中的yield（上） | APTX4869</title><meta name="description" content="其实，我并不是因为迭代或者生成器或者研究PHP手册才认识的yield，要不是协程，我到现在也不知道PHP中还有yield这么个鬼东西。人家这个东西是从PHP 5.5就开始引入了，官方名称叫做生成器。你要说为什么5.5年代的东西，现在才拿出来。我还想问你哟，PHP 5.3就有了的namespace为毛到最近这几年才开始正式投产。 那么，问题来了，这东西到底是有何用？ 先来感受一个问题，给你100Kb"><meta name="author" content="Irelia"><meta name="copyright" content="Irelia"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="17. PHP中的yield（上）"><meta name="twitter:description" content="其实，我并不是因为迭代或者生成器或者研究PHP手册才认识的yield，要不是协程，我到现在也不知道PHP中还有yield这么个鬼东西。人家这个东西是从PHP 5.5就开始引入了，官方名称叫做生成器。你要说为什么5.5年代的东西，现在才拿出来。我还想问你哟，PHP 5.3就有了的namespace为毛到最近这几年才开始正式投产。 那么，问题来了，这东西到底是有何用？ 先来感受一个问题，给你100Kb"><meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="17. PHP中的yield（上）"><meta property="og:url" content="https://seesaw.fun/2020/07/08/17.%20PHP%E4%B8%AD%E7%9A%84yield%EF%BC%88%E4%B8%8A%EF%BC%89.html"><meta property="og:site_name" content="APTX4869"><meta property="og:description" content="其实，我并不是因为迭代或者生成器或者研究PHP手册才认识的yield，要不是协程，我到现在也不知道PHP中还有yield这么个鬼东西。人家这个东西是从PHP 5.5就开始引入了，官方名称叫做生成器。你要说为什么5.5年代的东西，现在才拿出来。我还想问你哟，PHP 5.3就有了的namespace为毛到最近这几年才开始正式投产。 那么，问题来了，这东西到底是有何用？ 先来感受一个问题，给你100Kb"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-07-08T03:05:01.871Z"><meta property="article:modified_time" content="2020-07-08T03:05:01.871Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://seesaw.fun/2020/07/08/17.%20PHP%E4%B8%AD%E7%9A%84yield%EF%BC%88%E4%B8%8A%EF%BC%89.html"><link rel="prev" title="3. php多进程初探---孤儿和僵尸" href="https://seesaw.fun/2020/07/08/3.%20php%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%88%9D%E6%8E%A2---%E5%AD%A4%E5%84%BF%E5%92%8C%E5%83%B5%E5%B0%B8.html"><link rel="next" title="15. PHP socket初探 --- 一些零碎细节的拾漏补缺（一）" href="https://seesaw.fun/2020/07/08/15.%20PHP%20socket%E5%88%9D%E6%8E%A2%20---%20%E4%B8%80%E4%BA%9B%E9%9B%B6%E7%A2%8E%E7%BB%86%E8%8A%82%E7%9A%84%E6%8B%BE%E6%BC%8F%E8%A1%A5%E7%BC%BA%EF%BC%88%E4%B8%80%EF%BC%89.html"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: false  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">APTX4869</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">17. PHP中的yield（上）</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-07-08 03:05:01"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-07-08</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-07-08 03:05:01"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-07-08</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>其实，我并不是因为迭代或者生成器或者研究PHP手册才认识的yield，要不是协程，我到现在也不知道PHP中还有yield这么个鬼东西。人家这个东西是从PHP 5.5就开始引入了，官方名称叫做生成器。你要说为什么5.5年代的东西，现在才拿出来。我还想问你哟，PHP 5.3就有了的namespace为毛到最近这几年才开始正式投产。</p>
<p>那么，问题来了，这东西到底是有何用？</p>
<p>先来感受一个问题，给你100Kb的内存（是的，你没有看错，就是100Kb），然后让你迭代输出一个从1开始一直到10000的数组，步进为1。</p>
<p>愈先迭代数组，必先创造数组。</p>
<p>所以，脑门一拍，代码一坨如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$start_mem = memory_get_usage();</span><br><span class="line">$arr = range( <span class="number">1</span>, <span class="number">10000</span> );</span><br><span class="line"><span class="keyword">foreach</span>( $arr <span class="keyword">as</span> $item )&#123;</span><br><span class="line">  <span class="comment">//echo $item.',';</span></span><br><span class="line">&#125;</span><br><span class="line">$end_mem = memory_get_usage();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">" use mem : "</span>. ( $end_mem - $start_mem ) .<span class="string">'bytes'</span>.PHP_EOL;</span><br></pre></td></tr></table></figure>

<p>一顿操作猛如虎，运行一下成绩1-5，你们感受一下：</p>
<p><img src="http://static.ti-node.com/6426293690343358464" alt=""></p>
<p>528440bytes，约莫就是528Kb，几乎是100Kb的五倍了，妈的这日子没法过了。</p>
<p><img src="http://static.ti-node.com/6426294138886422529" alt=""></p>
<p>毕竟你们也知道，最近内存价格确实贵，国家也在号召低碳节能减排，你多耗费5倍内存，就意味着多排放5倍的二氧化碳，就意味着要为多用的内存多花钱贡献给棒子… …你想想，那可是棒子。</p>
<p>人都是被逼出来的，于是yield可以来救场了，大概代码如下，注意看操作：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$start_mem = memory_get_usage();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yield_range</span><span class="params">( $start, $end )</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>( $start &lt;= $end )&#123;</span><br><span class="line">    $start++;</span><br><span class="line">    <span class="keyword">yield</span> $start;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>( yield_range( <span class="number">0</span>, <span class="number">9999</span> ) <span class="keyword">as</span> $item )&#123;</span><br><span class="line">  <span class="keyword">echo</span> $item.<span class="string">','</span>;</span><br><span class="line">&#125;</span><br><span class="line">$end_mem = memory_get_usage();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">" use mem : "</span>. ( $end_mem - $start_mem ) .<span class="string">'bytes'</span>.PHP_EOL;</span><br></pre></td></tr></table></figure>

<p>运行一下，你们感受一下：</p>
<p><img src="http://static.ti-node.com/6426306722616311809" alt=""></p>
<p>首先，我们观察一下yield_range这个函数跟普通函数不一样的地方，就是普通函数往往都是使用return来返回结果，而这个中则是yield。其次是普通函数中return只能返回一次，这个yield能返回好多次。</p>
<p>那么，我们来分析一波儿这个神奇的yield_range函数。这个yield关键字到底返回的是什么？我们简单看一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yield_range</span><span class="params">( $start, $end )</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>( $start &lt;= $end )&#123;</span><br><span class="line">    $start++;</span><br><span class="line">    <span class="keyword">yield</span> $start;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$rs = yield_range( <span class="number">1</span>, <span class="number">100</span> );</span><br><span class="line">var_dump( $rs );</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">object(Generator)#1 (0) &#123;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>yield返回的是一个叫做Generator（中文名就是生成器）的object对象，而这个生成器是实现了Iterator接口（至于Iterator接口，你们去PHP手册上搜索吧）。所以，既然实现了Iterator接口（也正是因为如此，这个东西可以使用foreach进行迭代，明白了吧？），所以可以有如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yield_range</span><span class="params">( $start, $end )</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>( $start &lt;= $end )&#123;</span><br><span class="line">    <span class="keyword">yield</span> $start;</span><br><span class="line">    $start++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$generator = yield_range( <span class="number">1</span>, <span class="number">10</span> );</span><br><span class="line"><span class="comment">// valid() current() next() 都是Iterator接口中的方法</span></span><br><span class="line"><span class="keyword">while</span>( $generator-&gt;valid() )&#123;</span><br><span class="line">  <span class="keyword">echo</span> $generator-&gt;current().PHP_EOL;</span><br><span class="line">  $generator-&gt;next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如下所示：</p>
<p><img src="http://static.ti-node.com/6426627373801668608" alt=""></p>
<p>重点来了：这个yield_range函数似乎能够记住它上一次运行到哪儿了，上一次运行的结果是什么，然后紧接着在下一次运行的时候继续从上次终止的地方继续开始。这不是普通的PHP函数可以做得到的！</p>
<p>我们知道，操作系统在调度进程的时候，会触发一个叫做“进程上下文切换”的概念。比如CPU从进程A调度给进程B了，那么当再次从进程B调度给进程A的时候，当初进程A运行到哪儿了、临时的数据结果是什么都是需要被还原的，不然，一切都要从头，那就要出大问题了。而，这个yield关键字，似乎在用户态（非系统内核级）就可以实现这个概念。所以说，用yield搞迭代，怕是真的很没出息的一件事，它能做的太多。</p>
<p>紧接着，我们需要认识一个生成器对象的一个方法，叫做send，简单看下下面这坨代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yield_range</span><span class="params">( $start, $end )</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>( $start &lt;= $end )&#123;</span><br><span class="line">    $ret = <span class="keyword">yield</span> $start;</span><br><span class="line">    $start++;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"yield receive : "</span>.$ret.PHP_EOL;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$generator = yield_range( <span class="number">1</span>, <span class="number">10</span> );</span><br><span class="line">$generator-&gt;send( $generator-&gt;current() * <span class="number">10</span> );</span><br></pre></td></tr></table></figure>

<p>运行结果如图所示：</p>
<p><img src="http://static.ti-node.com/6426631112352595969" alt=""></p>
<p>send方法可以修改yield的返回值，但是，你也不能想当然，比如下面这坨代码，你们以为运行结果是什么样呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yield_range</span><span class="params">( $start, $end )</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>( $start &lt;= $end )&#123;</span><br><span class="line">    $ret = <span class="keyword">yield</span> $start;</span><br><span class="line">    $start++;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"yield receive : "</span>.$ret.PHP_EOL;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$generator = yield_range( <span class="number">1</span>, <span class="number">10</span> );</span><br><span class="line"><span class="keyword">foreach</span>( $generator <span class="keyword">as</span> $item )&#123;</span><br><span class="line">  $generator-&gt;send( $generator-&gt;current() * <span class="number">10</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本来以为运行结果是类似于这样的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">10</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">20</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">30</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">40</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">50</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">60</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">70</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">80</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">90</span></span><br><span class="line"><span class="keyword">yield</span> receive : <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>然而，唯物主义告诉我们：</p>
<p><img src="http://static.ti-node.com/6426632376524210177" alt=""></p>
<p>结果是打脸的，你们感受一下：</p>
<p><img src="http://static.ti-node.com/6426632517612208129" alt=""></p>
<p>为什么我把php版本信息什么的打印出来呢？因为，这是个bug，这是个php的bug，至少我正在使用的PHP 7.1.17版本是有这个bug的，你不要以为这里面有什么高深莫测的技术，就是bug而已。下面是bug链接，你们可以去观摩一下：</p>
<p><a href="https://bugs.php.net/bug.php?id=76104" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=76104</a><br><a href="https://stackoverflow.com/questions/37817315/how-does-generatorsend-work" target="_blank" rel="noopener">https://stackoverflow.com/questions/37817315/how-does-generatorsend-work</a></p>
<p>总结一句话，就是不要在foreach中使用生成器的send方法。</p>
<p>然而，我在国内的一些有关php yield的文章中，都没有看到有人提及这个bug，我坑我自己是淌过了，你们是没必要再淌了。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Irelia</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://seesaw.fun/2020/07/08/17.%20PHP%E4%B8%AD%E7%9A%84yield%EF%BC%88%E4%B8%8A%EF%BC%89.html">https://seesaw.fun/2020/07/08/17.%20PHP%E4%B8%AD%E7%9A%84yield%EF%BC%88%E4%B8%8A%EF%BC%89.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/08/3.%20php%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%88%9D%E6%8E%A2---%E5%AD%A4%E5%84%BF%E5%92%8C%E5%83%B5%E5%B0%B8.html"><img class="prev_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">3. php多进程初探---孤儿和僵尸</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/08/15.%20PHP%20socket%E5%88%9D%E6%8E%A2%20---%20%E4%B8%80%E4%BA%9B%E9%9B%B6%E7%A2%8E%E7%BB%86%E8%8A%82%E7%9A%84%E6%8B%BE%E6%BC%8F%E8%A1%A5%E7%BC%BA%EF%BC%88%E4%B8%80%EF%BC%89.html"><img class="next_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">15. PHP socket初探 --- 一些零碎细节的拾漏补缺（一）</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Irelia</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script></body></html>